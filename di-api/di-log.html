<!DOCTYPE html>
<html>
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <title>Dynamic Ingest Log</title>
        <style>
            body {
                font-family: sans-serif;
                margin: 4em;
            }
            .hide {
                display: none;
            }
            .show {
                display: block;
            }
        </style>
    </head>
    <body>
        <h1>Dynamic Ingest Log</h1>
        <h2>Account: Brightcove Learning (57838016001)</h2>
        <div id="videoLogBlock">
            <table>
                <thead>
                    <tr>
                        <th>Video ID</th>
                        <th>Name</th>
                        <th>Renditions created</th>
                    </tr>
                </thead>
                <tbody id="logBody"></tbody>
            </table>
        </div>
        <script src="video-ids.js"></script>
        <script>
        var BCLS = ( function (videoIdArray) {
            var tr,
                td,
                logBody = document.getElementById('logBody');
                i,
                iMax,
                videoDataArray = [],
                requestOptions = {},
                currentVideo,
                // functions
                submitRequest,
                setVideoRequestOptions,
                setSourcesRequestOptions,
                bclslog;

                /**
                 * Logging function - safe for IE
                 * @param  {string} context - description of the data
                 * @param  {*} message - the data to be logged by the console
                 * @return {}
                 */
                bclslog = function (context, message) {
                    if (window["console"] && console["log"]) {
                      console.log(context, message);
                    }
                    return;
                };

                // function to set up video data request
                setVideoRequestOptions = function () {

                };
                // function to set up video sources request
                setSourcesRequestOptions = funciton () {

                };
                // function to make the cms api requests
                submitRequest = function (options, proxyURL, type) {
                    var httpRequest = new XMLHttpRequest(),
                        requestData,
                        responseData,
                        parsedData,
                        getResponse = function () {
                            try {
                                if (httpRequest.readyState === 4) {
                                  if (httpRequest.status === 200) {
                                    logResponse(type, httpRequest.responseText);
                                    responseData = httpRequest.responseText;
                                    switch (type) {
                                        case "video":
                                        if (responseData.indexOf("TIMEOUT") > 0) {
                                            t1 = setTimeout(setVideoRequestOptions, 1000);
                                        } else {
                                            parsedData = JSON.parse(responseData);
                                            di_url_display.value = "https://ingest.api.brightcove.com/v1/accounts/" + account_id + "/videos/" + parsedData.id + "/ingest-requests";
                                            setDIOptions();
                                        }
                                        break;
                                        case "sources":
                                        totalIngested++;
                                        logResponse("totalIngested", totalIngested);
                                        if (videoNumber < totalVideos - 1) {
                                            videoNumber++;
                                            logResponse("Processing video number", videoNumber);
                                            // pause to avoid CMS API timeouts
                                            t2 = setTimeout(setCMSOptions, 1000);
                                        }
                                        break;
                                    }
                                  } else {
                                    alert("There was a problem with the request. Request returned " + httpRequest.status);
                                  }
                                }
                              }
                              catch(e) {
                                alert('Caught Exception: ' + e);
                              }
                        };
                    // set up request data
                    requestData = "client_id=" + options.client_id + "&client_secret=" + options.client_secret + "&url=" + encodeURIComponent(options.url) + "&requestBody=" + encodeURIComponent(options.requestBody) + "&requestType=" + options.requestType;
                    // set response handler
                    httpRequest.onreadystatechange = getResponse;
                    // open the request
                    httpRequest.open("POST", proxyURL);
                    // set headers
                    httpRequest.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
                    // open and send request
                    httpRequest.send(requestData);
                };

                bclslog('videoIdArray', videoIdArray);
                iMax = videoIdArray.length;
                for (i = 0; i < iMax; i++) {
                    currentVideo = videoIdArray[i];
                    setVideoRequestOptions();
                }

            })(videoIdArray);
        </script>
    </body>
</html>
