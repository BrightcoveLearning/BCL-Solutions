<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title></title>
    <style>

    </style>
  </head>
  <body>
    <pre id="results"></pre>
    <script type="text/javascript" src="./assets/cbs.js"></script>
    <script type="text/javascript" src="//docs.brightcove.com/en/scripts/bc-mapi.js"></script>
    <script>
      var params = {},
          onSearchResults,
          pageNumber = 0,
          pageLast = 23,
          videoItems = [],
          newVideoItems = [],
          callMapi,
          printResults,
          cullDone,
          findObjectInArray;
      BCMAPI.url = "http://api.brightcove.com/services/library";
      BCMAPI.token = "t5TFTPsDxqM_3fXfw1O1EB7OtgQo6sE2XdEJCy-NNnmoFgcUYzpbxw..";
      BCMAPI.callback = "onSearchResults";
      params.video_fields = "referenceId";
      params.sort_by="PUBLISH_DATE:DESC";

    /*
    find index of an object in array of objects
    based on some property value
    returns index if found, otherwise returns -1
    */
    findObjectInArray = function (targetArray, objProperty, value) {
        var i, totalItems = targetArray.length, objFound = false;
        for (i = 0; i < totalItems; i++) {
            if (targetArray[i][objProperty] === value) {
                objFound = true;
                return i;
            }
        }
        if (objFound === false) {
            return -1;
        }
    };
      callMapi = function () {
        params.page_number = pageNumber;
        BCMAPI.search(params);
      }
      onSearchResults = function () {
        var i, j;
        for (i = 0; i < videoItems.length; i++) {
            j = findObjectInArray(videoData, "reference_id", videoItems[i]);
            newVideoItems.push(videoData[j])
        }
        if (pageNumber < pageLast) {
            pageNumber++;
            callMapi();
        } else {
            console.log("videoItems", videoItems);
            cullDone();
        }
      }
      cullDone = function () {
        var i, j, refID;
        for (i = 0; i < videoItems.length; i++) {
            refID = videoItems[i].referenceId;
            console.log("refID", refID);
            j = findObjectInArray(videoData, "reference_id", refID);
            if (j > -1) {
                videoData.splice(j, 1);
            }
        }
        console.log("videoData", videoData);
        printResults();
      }
      printResults = function () {
        var results = document.getElementById("results");
        results.innerHTML = JSON.stringify(videoData, null, "  ");
      }
      callMapi();

    </script>
  </body>
</html>
