;
/* module-key = 'com.atlassian.jira.plugins.jira-editor-plugin:instance', location = 'js/editor-instance.js' */
define("jira/editor/instance",["jira/dialog/dialog","jira/editor/analytics","jira/editor/analytics-shortcuts","jira/util/navigator","jira/editor/tinymce","jira/editor/context-manager","jira/editor/context-detector","jira/editor/schema","jira/editor/selection","wiki-edit/SpeechRecognition","jira/util/logger","jquery","backbone","underscore","wrm/context-path"],function(h,k,i,q,o,p,j,g,f,b,n,d,m,l,c){var a=function(s,r){this.element=s;this.options=l.extend({},r)};l.extend(a.prototype,m.Events);var e=27;a.prototype.init=function(s){this.editor=s;this.operationOverride={};this.analyticsShortcuts=new i(this.editor);this.selection=new f(this.editor);this.editor.on("NodeChange",function(x){var v=k.startMeasure();if(!x){return}if(x.element.nodeName.toLowerCase()==="img"){this.editor.fire("content")}var u=k.startMeasure();var w=d(x.element);this.trigger("selection:update",{insidePreformatted:j.detectPre(w),preformattedSelected:j.detectPreWithinSelection(this.editor.selection.getContent()),insideTable:j.detectTable(w),insideA:j.detectA(w)});u.measure("nodechange.context-detection");v.measure("nodechange")}.bind(this));this.editor.on("change SetContent blur",this._onChange.bind(this));this.editor.on("keyup",l.debounce(this._onChange.bind(this),1000));this.editor.on("init",function(v){var u=v.target;["tt","del","sup","sub","cite"].forEach(function(x){u.formatter.register(x,{block:x,remove:"all"})});var w=u.formatter.get("removeformat");if(w.length>0&&typeof w[0]==="object"){w[0].selector+=",tt"}});s.on("keydown",function(u){if(u.isDefaultPrevented()){return}var v=d(s.selection.getStart());if(u.keyCode===o.util.VK.ENTER&&!u.shiftKey&&v.is("td > p, th > p, th > br, td > br, td, th")){u.preventDefault();s.execCommand("InsertLineBreak",false,u)}if(h.current&&u.keyCode===e){h.current.hide(true,{reason:h.HIDE_REASON.cancel,})}if(u.keyCode===o.util.VK.ENTER&&(v.is("panel-title, panel-title *")||v.parent().hasClass("panelHeader"))){u.preventDefault()}});var r=function(){if((/(Edge)\/(\d+)\.(\d+)/).test(q._getUserAgent())){return"edge"}else{if(q.isIE()){return"ie"}else{if(q.isChrome()){return"chrome"}else{if(q.isMozilla()){return"firefox"}else{if(q.isSafari()){return"safari"}}}}}return""};k.sendEvent("editor.instance.init");k.sendEvent("bundled.editor.instance.init");var t=r();if(t){k.sendEvent("editor.instance.init."+t)}this.contextManager=new p(this);s.contextManager=this.contextManager};a.prototype.getId=function(){return this.editor.id};a.prototype.relayEvent=function(s,t,r){this.editor.on(s,function(u){t(u)},r)};a.prototype.getAllowedOperations=function(){return["paragraph","h1","h2","h3","h4","h5","h6","monospace","paragraph-quote","block-quote","delete","superscript","subscript","cite","monospace-inline",":)",":(",":P",":D",";)","(y)","(n)","(i)","(/)","(x)","(!)","(+)","(-)","(?)","(on)","(off)","(*)","(*r)","(*g)","(*b)","(*y)","bold","italic","underline","color","bullet-list","numbered-list","mention","table","code","noformat","panel","hr","speech","link","link-mail","link-anchor","link-attachment","image","image-attachment","attachment","editorInsertContent","editorInsertContentInNewLine","editorReplaceContent","editorReplaceContentInNewLine"]};a.prototype._isOperationSupported=function(r){var s=this.getAllowedOperations().filter(function(t){if(t instanceof Object){return t.name===r}else{return t===r}});return s.length>0};a.prototype._assertOperationIsSupported=function(r){if(!this._isOperationSupported(r)){n.error("Operation not supported:",r)}};a.prototype._selectedTextSanitized=function(){return g.sanitizeHtml(this.editor.selection.getContent(),this.editor,this.pasteInsidePreSchemaSpec)};a.prototype.executeOperation=function(A,x){this._assertOperationIsSupported(A);var t=this._mapOperationNameToTinymce(A);var y=this.operationOverride[A];if(y){k.sendEvent("editor.instance.operation."+A);y(x);return true}if("editorReplaceContentInNewLine"===A){this.editor.execCommand("mceReplaceContent",false,"<br />"+x.content)}else{if("editorReplaceContent"===A){this.editor.execCommand("mceReplaceContent",false,x.content)}else{if("editorInsertContentInNewLine"===A){this.editor.insertContent("<br />"+x.content)}else{if("editorInsertContent"===A){this.editor.insertContent(x.content)}else{if("hr"===A){this.editor.insertContent("<hr />")}else{if("color"===A){this.editor.execCommand("ForeColor",true,x)}else{if(["h1","h2","h3","h4","h5","h6","paragraph","paragraph-quote","block-quote","monospace","monospace-inline","cite"].indexOf(A)>-1){this.editor.execCommand("mceToggleFormat",true,t)}else{if(["bold","italic","underline","delete","superscript","subscript"].indexOf(A)>-1){if(this.selection.trimSelection()){if(!this.selection.hasSelection()){k.sendEvent("editor.instance.selection.collapsed",{op:A});return false}else{k.sendEvent("editor.instance.selection.trimmed",{op:A})}}this.editor.execCommand(t,true)}else{if(["bullet-list","numbered-list"].indexOf(A)>-1){this.editor.execCommand(t,true)}else{if(this._emoticonSourceMap(A)){var z;if(AJS&&AJS.contextPath){z=AJS.contextPath()}else{z=""}var w=z+"/images/icons/emoticons/"+this._emoticonSourceMap(A);this.editor.insertContent('<img class="emoticon" src="'+w+'" height="16" width="16" align="absmiddle" alt="" border="0">')}else{if("link"===A){var v=(this._selectedTextSanitized()||"link title");this.editor.selection.setContent("["+v+"|http://example.com]")}else{if("link-anchor"===A){var v=(this._selectedTextSanitized()||"anchor");this.editor.selection.setContent("[#"+v+"]")}else{if("link-mail"===A){var v=(this._selectedTextSanitized()||"mail@example.com");this.editor.selection.setContent("[mailto:"+v+"]")}else{if("mention"===A){var v=(this._selectedTextSanitized()||"Mention someone by typing their name...");this.editor.selection.setContent("@");var s=this.getSelectionStart();this.editor.selection.setContent(v);this.setSelectionStart(s)}else{if("attachment"===A&&x.attachment){if(x.attachment.type==="image"){var r=x.attachment.href||c()+"/images/icons/attach/image.gif";if(x.attachment.thumbnailable){r=r.replace("/attachment/","/thumbnail/")}var u=JIRA.Editor.Tags.Templates.attachedImage({source:r,filename:x.attachment.name})}else{var u=JIRA.Editor.Tags.Templates.attachedFile({title:x.attachment.name,href:x.attachment.href,filename:x.attachment.name})}this.editor.insertContent(u)}else{if("code"===A){var v=(this._selectedTextSanitized()||"// code placeholder"+"\n");this.editor.selection.setContent('<pre class="code panel" data-language="code-java">'+v+"</pre>")}else{if("panel"===A){var v=(this.editor.selection.getContent()||"Some text with a title");this.editor.selection.setContent('<div class="plain panel" style="border-width: 1px;"><panel-title>'+"My title"+"</panel-title><p>"+v+"</p></div>")}else{if("noformat"===A){var v=(this._selectedTextSanitized()||"*no* further _formatting_ is done here");this.editor.selection.setContent('<pre class="noformat panel">'+v+"</pre>")}else{if("table"===A){var v=(this.editor.selection.getContent()||("Col"+" A1"));this.editor.selection.setContent('<div class="table-wrap"><table class="confluenceTable mce-item-table" data-mce-selected="1"><tbody><tr><th class="confluenceTh">'+"Heading"+' 1</th><th class="confluenceTh">'+"Heading"+' 2</th></tr><tr><td class="confluenceTd">'+v+'</td><td class="confluenceTd">Col A2</td></tr></tbody></table></div>');k.sendEvent("editor.instance.table.toolbar")}else{if("speech"===A){b.start(null,this)}else{if(["link-attachment","image","image-attachment"].indexOf(A)>-1){n.warn("Not supported yet "+A);return false}else{n.warn("Unsupported operation "+A);return false}}}}}}}}}}}}}}}}}}}}}k.sendEvent("editor.instance.operation."+A);this.trigger("content");n.trace("jira.editor.operation.executed");return true};a.prototype._mapOperationNameToTinymce=function(r){var s={bold:"Bold",italic:"Italic",underline:"Underline","bullet-list":"InsertUnorderedList","numbered-list":"InsertOrderedList",blockquote:"mceBlockQuote",paragraph:"p","paragraph-quote":"blockquote","block-quote":"blockquote",monospace:"samp","monospace-inline":"samp-inline","delete":"strikethrough",superscript:"superscript",subscript:"subscript"};if(r in s){return s[r]}return r};a.prototype._emoticonSourceMap=function(s){var r={":)":"smile.png",":(":"sad.png",":P":"tongue.png",":D":"biggrin.png",";)":"wink.png","(y)":"thumbs_up.png","(n)":"thumbs_down.png","(i)":"information.png","(/)":"check.png","(x)":"error.png","(!)":"warning.png","(+)":"add.png","(-)":"forbidden.png","(?)":"help_16.png","(on)":"lightbulb_on.png","(off)":"lightbulb.png","(*)":"star_yellow.png","(*r)":"star_red.png","(*g)":"star_green.png","(*b)":"star_blue.png","(*y)":"star_yellow.png","(flag)":"flag.png","(flagoff)":"flag_grey.png"};if(s in r){return r[s]}};a.prototype.focus=function(){if(!this.editor.initialized||this.editor.removed||this.editor.destroyed){n.warn("bypassing `editor-instance.focus` because the editor instance hasn't initialized yet or already removed");return this}this.editor.focus();this.editor.nodeChanged();return this};a.prototype.destroy=function(){this.editor.contextManager=null;this.editor.remove();k.sendEvent("editor.instance.destroy");k.sendEvent("bundled.editor.instance.destroy")};a.prototype.setContent=function(u,t,r){var s={};if(t){s={format:"raw"}}s.no_events=r;u=u||"";this.editor.setContent(u,s);this.lastContent=this.getContent();if(!r){this.trigger("content")}};a.prototype.replaceSelection=function(r){this.editor.selection.setContent(r);this.trigger("content")};a.prototype.selectAll=function(){this.editor.selection.select(this.editor.getBody(),true)};a.prototype.getSelectionStart=function(){return this.editor.selection.getRng(true)};a.prototype.setSelectionStart=function(s){var r=this.editor.selection.getRng(true);r.setStart(s.startContainer,s.startOffset);this.editor.selection.setRng(r)};a.prototype.getContent=function(s){var r={};if(s){r={format:"raw"}}return this.editor.getContent(r)};a.prototype._onChange=function(){if(this.editor.destroyed){return}var r=this.getContent();var s=r!==this.lastContent;this.lastContent=r;if(!this.hidden&&s){this.trigger("content",this.getContent())}};a.prototype.getSelectedContent=function(r){if(r){return this.editor.selection.getContent({format:"text"})}else{return this.editor.selection.getContent()}};a.prototype.addShortcut=function(r,s){this.editor.addShortcut(r,"",s)};a.prototype.removeShortcut=function(r){this.editor.shortcuts.remove(r)};a.prototype.addOperationOverride=function(r,s){this._assertOperationIsSupported(r);this.operationOverride[r]=s};a.prototype.removeOperationOverride=function(r){this._assertOperationIsSupported(r);delete this.operationOverrideoperationOverride[r]};a.prototype.hide=function(){this.hidden=true;this.editor.hide()};a.prototype.show=function(){this.editor.show();delete this.hidden};a.prototype.isVisible=function(){return !this.editor.isHidden()};a.prototype.switchMode=function(r){this.trigger("switchMode",r)};a.prototype.enable=function(){this.editor.setProgressState(false)};a.prototype.disable=function(){this.editor.setProgressState(true)};return a});;
;
/* module-key = 'com.atlassian.jira.plugins.jira-editor-plugin:instance', location = 'js/editor-resources.js' */
define("jira/editor/resources",["jira/editor/tinymce","jira/editor/wrm","wrm/require","jquery"],function(e,g,b,f){var d={};var c={};d.loadPlugins=function(h){var i=h.filter(function(j){return j.resource}).map(function(j){e.PluginManager.urls[j.name]=j.resource;return"wr!"+j.resource});return i.length>0?b(i):new f.Deferred().resolve()};d.require=function(h){return b(h.filter(function(i){return !c[i]}).map(function(i){return"wr!"+i}))};d.loadCssResources=function(){return new f.Deferred().resolve(a(g.getResources())).promise()};return d;function a(h){if(typeof h!=="object"||!h.length){return[]}return h.map(function(i){return i.replace(",","%2C")})}});;