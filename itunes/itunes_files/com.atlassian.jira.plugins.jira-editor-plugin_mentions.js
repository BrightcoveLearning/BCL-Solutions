;
/* module-key = 'com.atlassian.jira.plugins.jira-editor-plugin:mentions', location = 'js/plugins/mentions/mentions-util.js' */
define("jira/editor/plugins/mentions/mentions-util",["jquery","underscore"],function(e,c){var a=8203;var b=65279;var d=function(g){g.preventDefault();g.stopPropagation();g.stopImmediatePropagation()};var f={isMentionNode:function(g){if(!g){return false}return e(g).is("a.user-hover")},isCaretAfterMention:function(g){return this.getMentionBeforeCaret(g)!=null},getMentionBeforeCaret:function(h){var g=this.getPreviousNode(h).node;if(this.isMentionNode(g)){return g}return null},getPreviousNode:function(m){var i=function(p){if(p.nodeType===Node.TEXT_NODE){return p.nodeValue.length}else{if(p.nodeType===Node.ELEMENT_NODE){return p.childNodes.length}else{return undefined}}};var n=m.getSelection();var j=n.anchorNode;var l=n.anchorOffset;var h={node:j,offset:n.anchorOffset};if(n.isCollapsed&&j){if(j.nodeType===Node.ELEMENT_NODE&&j.childNodes){var o=n.anchorOffset-1;if(o<0){j=j.childNodes[0];l=0;var g=this._getPreviousSiblingSkipEmptyTextNodes(j,l);if(g){return{node:g,offset:i(g)}}}else{var k=o===j.childNodes.length-1;j=j.childNodes[o];l=i(j);var g=this._getPreviousSiblingSkipEmptyTextNodes(j,l,k);if(g){return{node:g,offset:i(g)}}}}else{if(j.nodeType===Node.TEXT_NODE){var g=this._getPreviousSiblingSkipEmptyTextNodes(j,l);if(g){return{node:g,offset:g===j?l:i(g)}}}}}return h},_getPreviousSiblingSkipEmptyTextNodes:function(i,k,h){h=h||false;var g=i;var j;while((j=this._isContentBeforeCursorEmpty(g,k,h)).outcome){g=g.previousSibling;k=undefined;h=j.relaxed}return g},_isContentBeforeCursorEmpty:function(i,l,k){var j={outcome:true,relaxed:false};var g={outcome:false,relaxed:false};var h={outcome:true,relaxed:true};if(i&&i.nodeType===Node.TEXT_NODE){if(c.isUndefined(l)){l=i.nodeValue.length}if(l===0){return j}if(l===1&&this._isEmptyCharacter(i.nodeValue.charCodeAt(0))&&i.nodeValue.length===1){return j}if(k){if(l===1&&i.nodeValue===" "){return h}}}return g},_isEmptyCharacter:function(g){return g===a||g===b},selectMention:function(h,g,i){if(g){d(g)}i.selection.select(h)}};return f});;
;
/* module-key = 'com.atlassian.jira.plugins.jira-editor-plugin:mentions', location = 'js/plugins/mentions/mention.js' */
define("jira/editor/plugins/mentions/mention-rte",["jira/mention/mention-matcher","jquery","jira/mention/mention","underscore","jira/editor/plugins/mentions/mentions-util"],function(c,e,b,a,f){var d=b.extend({init:function(h,i,g){b.prototype.init.call(this,h);this.editor=i;this.skipProcessing=g},_replaceCurrentUserName:function(h,g){if(this._selectMentionText()){this.editor.execCommand("mceInsertContent",false,this._renderMentionLink(h,g))}},_selectMentionText:function(){var o=this._getDocument();var p=this._getSelection();if(p&&p.isCollapsed){var l=this._getNodeForUsernameRetrieval();var g=this._getPreviousSiblingsTextNodes(l.node);if(g.length>0){var h=g[0];var n=g[g.length-1];var j=l.offset;var i=this._getStringFormPreviousSiblingsTextNodes(g,j);var k=c.getLastWordBoundaryIndex(i,true);var m=o.createRange();m.setStart(h,k+1);m.setEnd(n,j);this.editor.selection.setRng(m);return true}}else{return false}},_renderMentionLink:function(h,g){return JIRA.Editor.Tags.Templates.mentionlink({username:h,displayname:g})},_getUserNameFromInput:function(){if(a.isFunction(this.skipProcessing)&&this.skipProcessing()){return null}var h=this._getSelection();if(h&&h.isCollapsed){var i=this._getNodeForUsernameRetrieval();var g=this._getPreviousSiblingsTextNodes(i.node);var j=this._getStringFormPreviousSiblingsTextNodes(g,i.offset);this.currentUserName=c.getUserNameFromCurrentWord(j,j.length);return this.currentUserName}else{return null}},_getStringFormPreviousSiblingsTextNodes:function(g,l){var k="";for(var h=0;h<g.length;h=h+1){var j=g[h];if(h===g.length-1){k=k+j.nodeValue.substring(0,l)}else{k=k+j.nodeValue}}return k},_getPreviousSiblingsTextNodes:function(h){var g=[];if(h&&h.nodeType===Node.TEXT_NODE){for(var i=h;i;i=i.previousSibling){if(i.nodeType===Node.TEXT_NODE){g.unshift(i);if(i.nodeValue.indexOf("@")>=0||i.nodeValue.indexOf("[~")>=0){return g}}else{break}}}return[]},_getNodeForUsernameRetrieval:function(){return f.getPreviousNode(this._getDocument())},_getSelection:function(){if(this.$textarea){var g=this.$textarea.get(0);if(g&&g.ownerDocument){return g.ownerDocument.getSelection()}}return null},_getDocument:function(){return this.$textarea.get(0).ownerDocument},_getOffsetTarget:function(){return e(this.editor.getContainer())}});return d});;