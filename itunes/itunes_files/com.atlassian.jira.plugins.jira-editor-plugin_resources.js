;
/* module-key = 'com.atlassian.jira.plugins.jira-editor-plugin:resources', location = 'js/plugins/paste-plugin.js' */
define("jira/editor/plugins/paste",["jira/editor/tinymce","jira/editor/converter/util/strings","jira/editor/schema","jira/editor/analytics","jquery","wrm/context-path","dndattachment/ctrlv/utility","dndattachment/ctrlv/base64decode","jira/editor/wrm","jira/flag","jira/util/formatter"],function(m,a,f,k,c,d,i,g,e,b,j){var h=e.isAttachmentsAllowed();m.create("tinymce.plugins.jira.Paste",{});m.PluginManager.add("jira.paste",m.plugins.jira.Paste);m.PluginManager.urls["jira.paste"]=true;function l(o){if(o){var p=o.split(",")[0];var n=p.split(":");if(n.length>1){return n[1].split(";")[0]}}}return{configure:function(o,s){function p(u){var v=o.editor;if(v&&v.editorUpload&&v.editorUpload.blobCache){return v.editorUpload.blobCache.getByUri(u)}}var t={URL:{upload:function(){}},BLOB_URL:{upload:function(u,v){k.sendEvent("editor.instance.paste.addimage.nocache.http");n(u,v)}},DATA_URL:{upload:function(u,w){k.sendEvent("editor.instance.paste.addimage.nocache.image");var v=l(u)||"image/png";q(new Blob([g.decodeBase64DataUri(u)],{type:v}),w)}},TINYMCE_CACHED_BLOB:{upload:function(v,w){var u=p(v,o.editor);if(u){k.sendEvent("editor.instance.paste.addimage.cache");q(u.blob(),w)}else{console.warn("no cached blob found in cache")}}}};function r(v){var u=p(v,o.editor);if(u){return t.TINYMCE_CACHED_BLOB}else{if(v.match(/^((data|blob):http)|(blob:)/)){return t.BLOB_URL}else{if(v.match(/^(data|blob):image/)){return t.DATA_URL}}}return t.URL}function q(v,w){var u=i.convertBlobToImage(v,w);if(!i.dropFileToElement(u,o.element.$textarea)){console.warn("Uploading attachment failed. Check 'allow attachment' setting.");b.showWarningMsg("","Adding attachments is not supported for this screen.",{close:"auto"});o.editor.dom.remove(o.editor.dom.select('img[data-filename="'+w+'"]'))}}function n(v,w){var u=new XMLHttpRequest();u.open("GET",v,true);u.responseType="blob";u.onload=function(x){q(this.response,w)};u.send()}s.plugins.push("paste");s.paste_data_images=true;s.paste_preprocess=function(w,u){var v=o.contextManager.getPasteSchemaForContext();u.content=f.sanitizeHtml(u.content,o.editor,v)};s.paste_postprocess=function(y,w){k.sendEvent("editor.instance.paste");var x=c(w.node).find("img:first-child:last-child");if(x.length===1&&x.is("img")){var B=x[0].src;if(x.hasClass("emoticon")&&a.startsWith(B,document.location.origin+d()+"/images/icons/emoticons/")){k.sendEvent("editor.instance.paste.emoticon");return}k.sendEvent("editor.instance.paste.image");var v=B;if(a.isAttachmentPath(B)||a.isThumbnailPath(B)){v=a.getFilenameFromHref(B)}var A={source:B,filename:v,width:x.attr("width"),height:x.attr("height"),id:x.attr("id"),vspace:x.attr("vspace")};var z=r(B);if(z===t.DATA_URL||z===t.BLOB_URL||z===t.TINYMCE_CACHED_BLOB){if(!!h){v=i.generateFileName()+".png";z.upload(B,v);A.filename=v;var u=JIRA.Editor.Tags.Templates.image(A);x.replaceWith(c(u))}else{b.showWarningMsg("","Adding attachments has been disabled by your Jira administrator.",{close:"auto"});x.remove()}}else{var u=JIRA.Editor.Tags.Templates.image(A);x.replaceWith(c(u))}}else{k.sendEvent("editor.instance.paste.other")}};return s}}});;
;
/* module-key = 'com.atlassian.jira.plugins.jira-editor-plugin:resources', location = 'js/plugins/wiki-autoformat-plugin.js' */
define("jira/editor/plugins/wiki-autoformat",["jira/editor/tinymce","jira/editor/analytics","jquery","jira/util/version","jira/featureflags/feature-manager","jira/editor/html-renderer","jira/util/logger"],function(m,l,e,b,p,k,n){var c={_REGEXES_EMOTICON:{SMILE:/\B(:-?)$/,SAD:/\B(:-?)$/,CHEEKY:/\B(:-?)$/,CHEEKY_2:/\B(:-?)$/,LAUGH:/\B(:-?)$/,WINK:/\B(;-?)$/,THUMBS_UP:/\B(\(y)$/,THUMBS_DOWN:/\B(\(n)$/,INFORMATION:/\B(\(i)$/,TICK:/\B(\(\/)$/,CROSS:/\B(\(x)$/,WARNING:/\B(\(!)$/,PLUS:/\B(\(\+)$/,MINUS:/\B(\(-)$/,QUESTION:/\B(\(\?)$/,LIGHT_ON:/\B(\(on)$/,LIGHT_OFF:/\B(\(off)$/,YELLOW_STAR:/\B(\(\*)$/,YELLOW_STAR_2:/\B(\(\*y)$/,RED_STAR:/\B(\(\*r)$/,GREEN_STAR:/\B(\(\*g)$/,BLUE_STAR:/\B(\(\*b)$/,FLAG:/\B(\(flag)$/,FLAG_OFF:/\B(\(flagoff)$/,HEART:/\B(<)$/,BROKEN_HEAR:/\B(<\/)$/}};var j;function a(q){return e("<div></div>").append(q.cloneNode(true)).html()}function o(q,r,s){var w;var u;if(!r){throw new Error("text node is null")}if(r.nodeType!==Node.TEXT_NODE){r=r.childNodes[s-1];s=r.length}for(var v=r,t=s;v&&v.nodeType===Node.TEXT_NODE;v=v.previousSibling){if(t===-1){t=v.nodeValue.length}if(t>q){return{container:v,offset:t-q}}else{if(t===q){u=0;w=v.parentNode;while(v=v.previousSibling){u++}return{container:w,offset:u}}else{q-=t;t=-1}}}return null}function g(r){var s;var t;if(!r||!r.collapsed){throw new Error("range is null or not collapsed")}s=r.startContainer;t=r.startOffset;if(s.nodeType===Node.ELEMENT_NODE&&t>0){s=s.childNodes[r.startOffset-1];if(s.nodeType===Node.TEXT_NODE){t=s.nodeValue.length}else{return""}}else{if(s.nodeType!==Node.TEXT_NODE){return""}}var q=s.nodeValue.substring(0,t);for(var u=s.previousSibling;u&&u.nodeType===Node.TEXT_NODE;u=u.previousSibling){q=u.nodeValue+q}return q}function i(s,t,r,q){return{handles:function(y){if(typeof q==="string"){q=[q]}else{if(!q||!q.length){q=[]}}var u=false;var x=y.selection.getRng(true);var A=x.commonAncestorContainer||{};if(!x.collapsed){return false}var w=y.contextManager;if(w.isPreContextActive()){l.sendEvent("editor.instance.autoformat.prevented",{context:"pre"});return false}for(var z=0,v=q.length;z<v;++z){if(w.isContextActive(q[z])){l.sendEvent("editor.instance.autoformat.prevented",{context:q[z]});return false}}u=s.test(g(x));return u},execute:function(z,v){var w;var u;var y;var A=1;var x;var B;var C=d(v);if(C===32){z.execCommand("mceInsertContent",false,"&nbsp;")}else{z.execCommand("mceInsertContent",false,String.fromCharCode(C))}w=z.selection.getRng(true);u=g(w);if(u[u.length-1]==="|"){u+=" ";A=0}y=s.exec(u.substring(0,u.length-1));x=o(y[1].length+A,w.commonAncestorContainer,w.startOffset);w.setStart(x.container,x.offset);B=e(w.commonAncestorContainer);z.selection.setRng(w);t(y,z.selection.getRng(true));j=z.selection.getRng(true);if(r){v.preventDefault();v.stopPropagation();m.dom.Event.cancel(v);return false}}}}function d(q){return e.browser.msie?q.keyCode:q.which}function f(){this.handlers={}}f.prototype={registerHandler:function(r,q){if(!this.handlers[r]){this.handlers[r]=[]}this.handlers[r].push(q)},executeHandlers:function(t,s,r){var q=true;e.each(this.handlers[t]||[],function(u,v){if(v.handles(s)){q=v.execute(s,r);n.trace("jira.editor.wiki.autoformatted");return false}});return q}};function h(v){var w=new f();function x(M,Q,L,N,J,I){var O=M.charCodeAt(0);var K=AJS.contextPath()+"/images/icons/emoticons/"+J;var P;P=i(Q,function(){var R=v.dom.createHTML("img",{src:K,alt:v.getLang(N),title:v.getLang(N),border:0,"class":"emoticon emoticon-"+L,"data-emoticon-name":L,align:"absmiddle"});v.execCommand("mceInsertContent",false,R,{skip_undo:true})},true);this.imagePath=K;w.registerHandler(O,P)}var u=b.isGreaterThanOrEqualTo("7.0")?"png":"gif";var y=[new x(")",c._REGEXES_EMOTICON.SMILE,"smile","emotions_dlg.smile","smile."+u),new x("(",c._REGEXES_EMOTICON.SAD,"sad","emotions_dlg.sad","sad."+u),new x("P",c._REGEXES_EMOTICON.CHEEKY,"tongue","emotions_dlg.tongue","tongue."+u),new x("p",c._REGEXES_EMOTICON.CHEEKY_2,"cheeky","emotions_dlg.tongue","tongue."+u),new x("D",c._REGEXES_EMOTICON.LAUGH,"biggrin","emotions_dlg.biggrin","biggrin."+u),new x(")",c._REGEXES_EMOTICON.WINK,"wink","emotions_dlg.wink","wink."+u),new x(")",c._REGEXES_EMOTICON.THUMBS_UP,"thumbs_up","emotions_dlg.thumbs_up","thumbs_up."+u),new x(")",c._REGEXES_EMOTICON.THUMBS_DOWN,"thumbs_down","emotions_dlg.thumbs_down","thumbs_down."+u),new x(")",c._REGEXES_EMOTICON.INFORMATION,"information","emotions_dlg.information","information."+u),new x(")",c._REGEXES_EMOTICON.TICK,"check","emotions_dlg.check","check."+u),new x(")",c._REGEXES_EMOTICON.CROSS,"error","emotions_dlg.error","error."+u),new x(")",c._REGEXES_EMOTICON.WARNING,"warning","emotions_dlg.warning","warning."+u),new x(")",c._REGEXES_EMOTICON.PLUS,"add","emotions_dlg.add","add."+u),new x(")",c._REGEXES_EMOTICON.MINUS,"forbidden","emotions_dlg.forbidden","forbidden."+u),new x(")",c._REGEXES_EMOTICON.QUESTION,"help_16","emotions_dlg.help_16","help_16."+u),new x(")",c._REGEXES_EMOTICON.LIGHT_ON,"lightbulb_on","emotions_dlg.lightbulb_on","lightbulb_on."+u),new x(")",c._REGEXES_EMOTICON.LIGHT_OFF,"lightbulb","emotions_dlg.lightbulb","lightbulb."+u),new x(")",c._REGEXES_EMOTICON.YELLOW_STAR,"star_yellow","emotions_dlg.star_yellow","star_yellow."+u),new x(")",c._REGEXES_EMOTICON.YELLOW_STAR_2,"star_yellow","emotions_dlg.star_yellow","star_yellow."+u),new x(")",c._REGEXES_EMOTICON.RED_STAR,"star_red","emotions_dlg.star_red","star_red."+u),new x(")",c._REGEXES_EMOTICON.GREEN_STAR,"star_green","emotions_dlg.star_green","star_green."+u),new x(")",c._REGEXES_EMOTICON.BLUE_STAR,"star_blue","emotions_dlg.star_blue","star_blue."+u),new x(")",c._REGEXES_EMOTICON.FLAG,"flag","emotions_dlg.flag","flag."+u),new x(")",c._REGEXES_EMOTICON.FLAG_OFF,"flag_grey","emotions_dlg.flag_grey","flag_grey."+u)];var B=new Array();for(var E=0;E<y.length;E++){B[E]=new Image();B[E].src=y[E].imagePath}function t(L,J){var K=v.formatter.get(L)[0];var I=v.dom.create(K.inline,{style:K.styles});I.appendChild(document.createTextNode(J+"{$caret}"));v.execCommand("mceInsertContent",false,a(I),{skip_undo:true});v.formatter.remove(L)}var H={"*":"bold",_:"italic","~":"subscript","^":"superscript","+":"underline","-":"strikethrough"};e.each(H,function(I,K){var J=new RegExp("(?:[\\s\\xA0\\u200b\\uFEFF]+|^)(\\"+I+"(?=[^\\s"+I+"])([^"+I+"]*?[^\\s]))$");w.registerHandler(I.charCodeAt(0),i(J,function(L){t(K,L[2]);l.sendEvent("editor.instance.autoformat.format")},true))});v.formatter.register("samp-inline",{inline:"samp"});var q=/(?:[\s\xA0\u200b]+|^)({{(?=[^\s])([^}]*?[^\s])})$/;if(p.isFeatureEnabled("jira.renderer.consider.variable.format")){q=/(?:^|[^$])(?:[\s\xA0\u200b]+|^)({{(?=[^\s])([^}]*?[^\s])})$/}w.registerHandler("}".charCodeAt(0),i(q,function(I){t("samp-inline",I[2]);l.sendEvent("editor.instance.autoformat.inlinecode")},true));v.formatter.register("cite",{inline:"cite"});w.registerHandler("?".charCodeAt(0),i(/(?:[\s\xA0\u200b]+|^)(\?\?(?=[^\s])([^\?]*?[^\s])\?)$/,function(I){t("cite",I[2]);l.sendEvent("editor.instance.autoformat.cite")},true));for(var E=1;E<=6;E++){(function(I){w.registerHandler(" ".charCodeAt(0),i(new RegExp("^\\u200b?(h"+I+"\\.)$"),function(){v.execCommand("formatBlock",false,"h"+I,{skip_undo:true});l.sendEvent("editor.instance.autoformat.header")},true))})(E)}w.registerHandler(" ".charCodeAt(0),i(/^\u200b?(bq\.)$/,function(){v.execCommand("formatBlock",false,"blockquote",{skip_undo:true});l.sendEvent("editor.instance.autoformat.bq")},true));w.registerHandler(" ".charCodeAt(0),i(/[^-]*[\s](\-\-\-?)$/,function(I){var J=I[1].length===2?"\u2013":"\u2014";v.execCommand("mceInsertContent",false,J,{skip_undo:true});l.sendEvent("editor.instance.autoformat.dash")},false));var G=i(/(([^\s-]+)(\-\-\-?)([^\s-]+))$/,function(I){var J=I[3].length===2?"\u2013":"\u2014";v.execCommand("mceInsertContent",false,I[2]+J+I[4],{skip_undo:true})},false);w.registerHandler(" ".charCodeAt(0),G);w.registerHandler(m.util.VK.ENTER,G);var s=i(/^\u200b?(\-\-\-\-)$/,function(){v.execCommand("mceInsertContent",false,"<hr />",{skip_undo:true});l.sendEvent("editor.instance.autoformat.hr")},true);w.registerHandler(" ".charCodeAt(0),s);w.registerHandler(m.util.VK.ENTER,s);var A=/(\{code)$/;if(p.isFeatureEnabled("jira.renderer.consider.variable.format")){A=/(?:^|[^$])(\{code)$/}w.registerHandler("}".charCodeAt(0),i(A,function(){v.execCommand("mceInsertContent",false,'<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"><pre class="code-java">{$caret} </pre></div></div>');l.sendEvent("editor.instance.autoformat.code")},true));var z=/(\{panel)$/;if(p.isFeatureEnabled("jira.renderer.consider.variable.format")){z=/(?:^|[^$])(\{panel)$/}w.registerHandler("}".charCodeAt(0),i(z,function(){v.execCommand("mceInsertContent",false,'<div class="plain panel"><panel-title>'+"My title"+"</panel-title><p>{$caret} </p></div>");l.sendEvent("editor.instance.autoformat.panel")},true));var F=/(\{noformat)$/;if(p.isFeatureEnabled("jira.renderer.consider.variable.format")){F=/(?:^|[^$])(\{noformat)$/}w.registerHandler("}".charCodeAt(0),i(F,function(){v.execCommand("mceInsertContent",false,'<div class="preformatted panel" style="border-width: 1px;"><div class="preformattedContent panelContent"><pre>{$caret} </pre></div></div>');l.sendEvent("editor.instance.autoformat.noformat")},true));w.registerHandler(m.util.VK.ENTER,i(/(^\u200b?\|\|\s*(?:[^|]*\s?\|\|\s?)+$)/,function(K){var N="<table class='confluenceTable'><tr>";var M="";var I=true;var O=e(K[1].slice(2,-2).split("||")).map(function(P){P=e.trim(this);I=I&&P==="";return P});if(I){O[0]="editor.autoformat.sampletext.firstcell"}for(var L=0,J=O.length;L<J;L++){N+="<th class='confluenceTh'>"+O[L]+"</th>";M+="<td class='confluenceTd'>&#x200b;</td>"}N+="</tr><tr>"+M+"</tr></table>";v.execCommand("mceInsertContent",false,N,{skip_undo:true});v.selection.select(e(v.selection.getRng(true).commonAncestorContainer).parents("table").find(I?"th":"td")[0].childNodes[0]);e(v.selection.getRng().startContainer).parent().closest('[contenteditable="true"]').focus();l.sendEvent("editor.instance.table.autoformat.plain")},true,"table"));w.registerHandler(m.util.VK.ENTER,i(/(^\u200b?\|\s?(?:[^|]*\s?\|\s?)+$)/,function(K){var M="<table class='confluenceTable'><tr>";var I=true;var N=e(K[1].slice(1,-1).split("|")).map(function(O){O=e.trim(this);I=I&&O==="";return O});if(I){N[0]="editor.autoformat.sampletext.firstcell"}for(var L=0,J=N.length;L<J;L++){M+="<td class='confluenceTd'>"+N[L]+"</td>"}M+="</tr></table>";v.execCommand("mceInsertContent",false,M,{skip_undo:true});I&&v.selection.select(e(v.selection.getRng(true).commonAncestorContainer).parents("table").find("td")[0].childNodes[0]);e(v.selection.getRng().startContainer).parent().closest('[contenteditable="true"]').focus();l.sendEvent("editor.instance.table.autoformat")},true,"table"));e.each({"]":/(?:\s|^)((\[[^\[^\]]+))$/,"\r":/(?:\s|^)((\[[^\[^\]]+)(?:\]))$/," ":/(?:\s|^)((\[[^\[^\]]+)(?:\]))$/},function(I,J){w.registerHandler(I.charCodeAt(0),i(J,function(K,M){var L=K[1]+(K[1].endsWith("]")?"":"]");k.renderMarkup(L,v.settings.target.getRenderParams()).then(function(N){N=e(new DOMParser().parseFromString(N,"text/html").body).find("p").unwrap().html();v.execCommand("mceInsertContent",false,N,{skip_undo:true});l.sendEvent("editor.instance.autoformat.wikilink")})},true))});var D=i(/\b(((https?|ftp):\/\/|(www\.))[\w\.\$\-_\+!\*'\(\),/\?:@=&%#~;\[\]]+)$/,function(I){var J=I[3]?I[1]:"http://"+I[1];var K=v.dom.create("a",{href:J});K.appendChild(document.createTextNode(I[1]));v.execCommand("mceInsertContent",false,a(K),{skip_undo:true});v.getDoc().execCommand("unlink",false,{});l.sendEvent("editor.instance.autoformat.autolink")},false,"a");w.registerHandler(" ".charCodeAt(0),D);w.registerHandler(m.util.VK.ENTER,D);var r=i(/\b((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?)$/i,function(I){var J=v.dom.create("a",{href:"mailto:"+I[1]});J.appendChild(document.createTextNode(I[1]));v.execCommand("mceInsertContent",false,a(J),{skip_undo:true});v.getDoc().execCommand("unlink",false,{})},false,"a");w.registerHandler(" ".charCodeAt(0),r);w.registerHandler(m.util.VK.ENTER,r);var C=function(K,J){var I=i(K,function(){v.execCommand("mceInsertContent",false,J,{skip_undo:true});l.sendEvent("editor.instance.autoformat.quickcorrect")},false);w.registerHandler(" ".charCodeAt(0),I);w.registerHandler(m.util.VK.ENTER,I)};C(/(?:\b|^)(jira)$/i,"Jira");C(/(?:\b|^)(bitbucket|[Bb]itBucket)$/,"Bitbucket");C(/(?:\b|^)(atlassian)$/,"Atlassian");C(/(?:\b|^)([Hh]ipchat)$/,"HipChat");v.on("keydown",function(I){var J=d(I);if(J===m.util.VK.ENTER){return w.executeHandlers(J,v,I)}},true);v.on("keypress",function(I){return w.executeHandlers(d(I),v,I)},true)}m.create("tinymce.plugins.jira.WikiAutoFormat",{init:function(q){q.on("init",function(){h(q)})}});m.PluginManager.add("jira.wikiautoformat",m.plugins.jira.WikiAutoFormat);m.PluginManager.urls["jira.wikiautoformat"]=true;return{configure:function(q,r){r.plugins.push("jira.wikiautoformat")}}});;
;
/* module-key = 'com.atlassian.jira.plugins.jira-editor-plugin:resources', location = 'js/plugins/prevent-default-plugin.js' */
define("jira/editor/plugins/prevent-default",["jira/editor/tinymce","jquery"],function(a,b){a.create("tinymce.plugins.jira.PreventDefaultPlugin",{init:function(c){var d=c.settings;c.on("init",function(){var f=c.getBody()._controller;if(f&&f.$textarea&&f.$textarea.get(0)){var g=f.$textarea.get(0).ownerDocument;if(g){var e=d.preventdefault.selector;b(g).on("click",e,function(h){h.preventDefault()})}}})}});a.PluginManager.add("jira.preventdefault",a.plugins.jira.PreventDefaultPlugin);a.PluginManager.urls["jira.preventdefault"]=true;return{configure:function(c,d){d.plugins.push("jira.preventdefault");d.preventdefault={selector:"a[contenteditable=false]"}}}});;
;
/* module-key = 'com.atlassian.jira.plugins.jira-editor-plugin:resources', location = 'js/plugins/editor-content-postprocess-plugin.js' */
define("jira/editor/plugins/editor-content-postprocess",["jira/editor/tinymce","jira/editor/converter/util/strings","jira/editor/util/temporaryAttachment","jira/editor/analytics"],function(i,b,a,h){var c=function(l,k){var j=l&&l.attr("class")||"";return j.indexOf(k)>=0};var f=function(j){j.parser.addAttributeFilter("class",function(k){var l=k.length;var m;while(l--){m=k[l];if(c(m,"user-hover")){m.attr("contenteditable","false");m.attr("tabindex","-1")}}})};var e=function(j){j.parser.addNodeFilter("h1,h2,h3,h4,h5,h6",function(l){var k=function(t,r){var s=t;var u=[];for(t=s.firstChild;t;t=t.next){if(t.name===r&&!t.firstChild){u.push(t)}}return u};var o=l.length;var p;while(o--){p=l[o];var n=k(p,"a");var m=n.filter(function q(r){return typeof r.attr("name")!=="undefined"});m.forEach(function(r){r.remove()})}})};var d=function(j){j.parser.addNodeFilter("div,pre",function(k){k.forEach(function(o){if(o.parent&&o.parent.name==="pre"&&o.name!=="panel-title"){o.unwrap()}if(!o.attr("class")&&o.name==="pre"){o.unwrap()}if(!c(o,"panel")||c(o,"panelHeader")||c(o,"panelContent")){return}if(c(o,"preformatted")){o.attr("class","noformat panel")}if(o.lastChild&&o.lastChild.firstChild&&/^code/.test(o.lastChild.firstChild.attr("class"))){o.attr("data-language",o.lastChild.firstChild.attr("class"));o.attr("class","code panel")}var m=o.firstChild;if(c(m,"panelHeader")){var n=m.attr("style");m.firstChild.unwrap();m.name="panel-title";m.attr("class",n)}var l=o.lastChild;if(c(l,"panel")||c(l,"panelContent")){var n=l.attr("style");if(c(o,"noformat")||c(o,"code")){l.firstChild.unwrap()}l.unwrap()}if(c(o,"noformat")||c(o,"code")){o.name="pre"}else{o.attr("class","plain panel")}})})};var g=function(j){j.parser.addNodeFilter("img",function(k){if(k.length===0){return}var m=a.getFormToken(j.getContainer());if(!m){console.warn("formToken not found, skipping invalid temporary attachment content post processing");return}var l=function(n){var o=n.attr("src");if(b.isTemporaryAttachmentPath(o)){var p="/secure/temporaryattachment/"+m;return !b.contains(o,p)}return false};k.filter(l).forEach(function(n){n.remove();h.sendEvent("editor.plugin.content-postprocess.temporary-attachment.removed")})})};i.create("tinymce.plugins.jira.EditorContentPostprocess",{init:function(j){j.on("PreInit",function(){g(j);f(j);e(j);d(j)})}});i.PluginManager.add("jira.editorcontentpostprocess",i.plugins.jira.EditorContentPostprocess);i.PluginManager.urls["jira.editorcontentpostprocess"]=true;return{configure:function(j,k){k.plugins.push("jira.editorcontentpostprocess");k.editor_content_postprocess={};return k}}});;