;
/* module-key = 'com.atlassian.jira.plugins.jira-editor-plugin:schema', location = 'js/editor-schema.js' */
define("jira/editor/schema",["jira/editor/schema-builder","jira/richeditor/editor-supported-operations","jira/editor/tinymce","jquery"],function(e,a,k,d){var b=["strong","b","em","i","tt","code","samp","sub","sup","del","cite","panel-title"];var h=[["td","table"],["th","table"],["td","p"],["th","p"]];var g=[];var c=["strong/b"];g.push("xml:lang");g.push("xml:space");var f={};f.getSchemaSpecBuilder=function(l){if(undefined===l){l=new e()}return l.withValidElements(a.getRequiredHtmlTags()).withNoBreak(b).withNoSelfNest(b).withNoNest(h).withUnwantedAttributes(g).withExtendedValidElements(c).withCustomElement("panel-title",["span","#text"],["style"]).setValidChildren("pre","br|span|#text|pre|p|panel-title")};f.getPasteSchemaSpecBuilder=function(l){if(undefined===l){l=f.getSchemaSpecBuilder()}return l.withUnwantedAttributes(["contenteditable"])};f.getPasteInsidePreSchemaSpecBuilder=function(l){if(undefined===l){l=new e()}return l.withValidElements(["br","span","p","pre"]).withUnwantedAttributes(["style"])};f.getSchemaFromSpec=function(m){var l=new k.html.Schema({schema:m.getType(),custom_elements:m.getCustomElements(),valid_children:m.getValidChildren(),valid_elements:m.getValidElements(),extended_valid_elements:m.getExtendedValidElements()});m.fixChildren(l);return l};function j(l){if("textContent" in document.body){l=l.replace(/(<br>|<br \/>)/g,"\n")}var m=d("<div>").addClass("richeditor-sanitize").append(l)[0];try{d(m).appendTo(document.body);return AJS.escapeHTML(m.textContent||m.innerText)}finally{d(m).remove()}}f.sanitizeHtml=function i(n,o,s){var l=d(o.selection.getStart()).add(o.selection.getEnd()).add(o.selection.getNode());if(l.is("pre, pre > *")){n=l.clone().html(j(n)).prop("outerHTML")}if(l.is("panel-title, panel-title > *")){n=j(n)}var p=f.getSchemaFromSpec(s);var q=new k.html.DomParser(o.settings,p);var m=new k.html.Serializer(o.settings,p);var r=q.parse(n,{forced_root_block:undefined});return m.serialize(r)};return f});;