<!DOCTYPE html>
<html>

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Video Trimming Tool</title>
    <link href="http://vjs.zencdn.net/5.0.2/video-js.css" rel="stylesheet">
    <script src="http://vjs.zencdn.net/5.0.2/video.js"></script>
    <style>
    body {
        font-family: Helvetica, sans-serif;
        margin: 2em;
    }

    #wrapper {
        position: relative;
        width: 500px;
        padding: 0;
        display: inline-block;
        vertical-align: top;
    }
    #inputWrapper {
        position: relative;
        width: 500px;
        padding: 0;
        display: inline-block;
        margin-right: 1em;
    }

    #positionOverlay {
        position: absolute;
        top: 0;
        right: .2em;
        background-color: #999;
        color: white;
        padding: .1em .2em;
    }

    #currentPosition {
        font-family: Monaco, 'Andale Mono', monospace;
    }

    #startTime, #endTime {
        font-family: Monaco, 'Andale Mono', monospace;
        background-color: #666;
        color: white;
    }

    video {
        position: relative;
    }

    textarea {
        background-color: #F5F5F5;
        color: #000099;
        font-family: Monaco, 'Andale Mono', monospace;
        width: 100%;
        height: 5em;
    }
    input {
        width: 95%;
    }
    </style>
</head>

<body>
    <h1>Video Trimming Tool</h1>
    <div id="inputWrapper">
        <div id="setSrc">
            <ol>
                <li>Enter a publicly accessible URL to the video clip you want to trim:
                <input id="srcURL" type="text" placeholder="http://learning-services-media.brightcove.com/videos/mp4/greatblueheron.mp4"></input></li>
            </ol>
        </div>
        <div id="setStart" style="opacity:.4">
            <ol start="2">
                <li>Play the video or drag the playhead to get to the time you want the clip to <strong>begin</strong>, and then click the button below.
                    <p><button id="setStartTime" disabled="disabled">Set Start Time</button></p>
                    <p>Start time: <span id="startTime"></span></p>
                </li>
            </ol>
        </div>
        <div id="setEnd" style="opacity:.4">
            <ol start="3">
                <li>Play the video or drag the playhead to get to the time you want the clip to <strong>end</strong>, and then click the button below.
                    <p><button id="setEndTime" disabled="disabled">Set End Time</button></p>
                    <p>End time: <span id="endTime"></span></p>
                </li>
            </ol>
        </div>
        <div id="zCode">
            <p>Code for your Zencoder request</p>
            <textarea id="requestCode"></textarea>
        </div>
    </div>
    <div id="wrapper">
        <video id="previewPlayer" class="video-js vjs-default-skin" controls preload="auto" width="500" height="281" poster="./assets/poster.png" data-setup='{"example_option":true}'>
            <source src="http://learning-services-media.brightcove.com/videos/mp4/greatblueheron.mp4" type='video/mp4' />
            <p class="vjs-no-js">To view this video please enable JavaScript, and consider upgrading to a web browser that <a href="http://videojs.com/html5-video-support/" target="_blank">supports HTML5 video</a></p>
        </video>
        <p id="positionOverlay">
            Current position (hh:mm:ss) <span id="currentPosition"></span>
        </p>
    </div>

    <script>
    'use strict';
    var currentPosition = document.getElementById('currentPosition'),
        setStart = document.getElementById('setStart'),
        setStartTime = document.getElementById('setStartTime'),
        setEnd = document.getElementById('setEnd'),
        setEndTime = document.getElementById('setEndTime'),
        startTime = document.getElementById('startTime'),
        startTimeValue = 0,
        endTime = document.getElementById('endTime'),
        endTimeValue = 0,
        requestCode = document.getElementById('requestCode'),
        srcURL = document.getElementById('srcURL'),
        currentTime,
        currentTimeString,
        settingStartTime = false,
        settingEndTime = false;


    /**
     * utility to extract h/m/s from seconds
     * @param {number} secs - seconds to convert to hh:mm:ss
     */
    function secondsToTime(secs) {
        var hours = Math.floor(secs / (60 * 60)),
            divisor_for_minutes = secs % (60 * 60),
            minutes = Math.floor(divisor_for_minutes / 60),
            divisor_for_seconds = divisor_for_minutes % 60,
            seconds = Math.ceil(divisor_for_seconds),
            obj = {};

        if (hours < 10) {
            hours = "0" + hours.toString();
        } else {
            hours = hours.toString();
        };

        if (minutes < 10) {
            minutes = "0" + minutes.toString();
        } else {
            minutes = minutes.toString();
        };

        if (seconds < 10) {
            seconds = "0" + seconds.toString();
        } else {
            seconds = seconds.toString();
        };

        obj = {
            'h': hours,
            'm': minutes,
            's': seconds
        };

        return obj;
    }
    videojs("previewPlayer").ready(function() {

        var player = this;

        function getCurrentTime() {
            var timeObj = {};
            currentTime = player.getCurrentTime();
            timeObj = secondsToTime(currentTime);
            currentTimeString = timeObj.h + ':' + timeObj.m + ':' + timeObj.s;
        }

        // event listeners

        player.on('timeupdate', function() {
            getCurrentTime();
            currentPosition.textContent = currentTimeString;
            if (settingStartTime) {
                startTime.textContent = currentTimeString;
            } else if (settingEndTime) {
                endTime.textContent = currentTimeString;
            }
        });
        player.on('play', function() {
            setStart.setAttribute('style', 'opacity:1');
            if (!settingEndTime) {
                settingStartTime = true;
                setStartTime.removeAttribute('disabled');
                setStart.setAttribute('style', 'opacity:1')
            }
        })
        srcURL.addEventListener('change' function() {
            player.src(srcURL.value);
            setStart.setAttribute('style', 'opacity:1');
        });
        setStartTime.addEventListener('click' function(){
            startTime.textContent = currentTimeString;
            startTimeValue = currentTime;
        });
    });
    </script>
</body>

</html>
